name: Update Blog Articles

  on:
    schedule:
      - cron: '0 9 * * 1'
    workflow_dispatch:

  jobs:
    update-blog:
      runs-on: ubuntu-latest
      permissions:
        contents: write

      steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: '3.11'

        - name: Install dependencies
          run: |
            pip install feedparser requests beautifulsoup4

        - name: Run blog update script
          run: python scripts/update_blog.py

        - name: Check for changes
          id: check_changes
          run: |
            if git diff --quiet index.html; then
              echo "changed=false" >> $GITHUB_OUTPUT
            else
              echo "changed=true" >> $GITHUB_OUTPUT
            fi

        - name: Commit and push changes
          if: steps.check_changes.outputs.changed == 'true'
          run: |
            git config --local user.email "github-actions[bot]@users.noreply.github.com"
            git config --local user.name "github-actions[bot]"
            git add index.html
            git commit -m "Auto-update: Refresh blog articles [skip ci]"
            git push
